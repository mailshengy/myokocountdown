<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Myoko Countdown + Dinner Voting</title>

  <style>
    :root{
      --paper:#efe6d8;
      --ink:#6b5e4b;
      --ink2:#7a6d5a;
      --sage:#9aa89b;
      --mist:#cfd8d3;
      --card: rgba(255,255,255,0.58);
      --card2: rgba(255,255,255,0.42);
      --shadow: 0 10px 28px rgba(0,0,0,0.06);
      --radius: 16px;
      --border: 1px solid rgba(107,94,75,0.12);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--ink);
      background: radial-gradient(circle at top, #f4ede3, var(--paper));
    }

    a{ color: inherit; }
    .wrap{
      max-width: 1120px;
      margin: 0 auto;
      padding: 42px 18px 70px;
    }

    header{
      text-align:center;
      padding: 18px 10px 8px;
    }
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,0.60), rgba(255,255,255,0.38));
      border-radius: 22px;
      padding: 22px 18px 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      border: var(--border);
    }
    .title{
      font-size: 2.4rem;
      letter-spacing: 0.18em;
      font-weight: 520;
      margin: 10px 0 8px;
    }
    .subtitle{
      color: var(--ink2);
      letter-spacing: 0.12em;
      font-size: 0.95rem;
      margin: 0 0 22px;
    }

    .countdown{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      max-width: 860px;
      margin: 0 auto;
    }
    .time-box{
      background: var(--card2);
      border-radius: var(--radius);
      padding: 18px 10px;
      border: var(--border);
    }
    .num{
      font-size: 2.55rem;
      font-weight: 540;
      color:#5f6f66;
      line-height: 1.1;
    }
    .lbl{
      margin-top: 6px;
      font-size: 0.75rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color:#7d8b82;
    }
    .statusline{
      margin-top: 14px;
      text-align:center;
      font-size: 0.92rem;
      color: #7d8b82;
      min-height: 1.2em;
    }

    .section{
      margin-top: 42px;
    }
    .section h2{
      text-align:center;
      font-size: 1.18rem;
      letter-spacing: 0.14em;
      font-weight: 650;
      margin: 0 0 12px;
      color: var(--ink);
      text-transform: uppercase;
    }
    .hint{
      text-align:center;
      margin: 0 auto 22px;
      max-width: 860px;
      color: var(--ink2);
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      align-items: stretch;
    }
    .card{
      background: var(--card);
      border-radius: 18px;
      padding: 18px 16px 16px;
      box-shadow: var(--shadow);
      border: var(--border);
      backdrop-filter: blur(6px);
    }

    .toprow{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
    }
    .name{
      margin: 0;
      font-size: 1.12rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }
    .cuisine{
      margin-top: 6px;
      font-size: 0.9rem;
      color: var(--ink2);
    }

    .meta{
      display:flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
      min-width: 220px;
    }
    .pillrow{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
    }
    .pill{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 7px 10px;
      border-radius: 999px;
      border: var(--border);
      background: rgba(255,255,255,0.55);
      font-size: 0.82rem;
      color: var(--ink);
      white-space: nowrap;
    }
    .icon{
      width: 18px;
      height: 18px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius: 6px;
      background: rgba(154,168,155,0.22);
      border: 1px solid rgba(154,168,155,0.30);
      font-size: 0.95rem;
      line-height: 1;
    }

    .badge{
      display:inline-flex;
      align-items:flex-start;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 12px;
      margin-top: 12px;
      background: rgba(154,168,155,0.16);
      border: 1px solid rgba(154,168,155,0.30);
      color: #56645b;
      font-size: 0.88rem;
    }

    .desc{
      margin: 12px 0 0;
      color: #6f6150;
      line-height: 1.5;
      font-size: 0.95rem;
    }

    .links{
      margin-top: 12px;
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .linkbtn{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 9px 10px;
      border-radius: 12px;
      border: var(--border);
      background: rgba(255,255,255,0.55);
      text-decoration: none;
      font-size: 0.88rem;
      color: var(--ink);
      cursor: pointer;
    }
    .linkbtn:hover{ background: rgba(255,255,255,0.70); }

    .actions{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(107,94,75,0.10);
    }

    button.vote{
      border: none;
      background: #9aa89b;
      color: #fff;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 0.92rem;
      cursor: pointer;
      transition: transform 0.06s ease;
    }
    button.vote:active{ transform: scale(0.98); }
    button.vote:disabled{
      opacity: 0.55;
      cursor: not-allowed;
    }

    .votes{
      font-size: 0.9rem;
      color: var(--ink2);
      text-align:right;
      min-width: 88px;
    }

    .smallnote{
      margin-top: 10px;
      font-size: 0.82rem;
      color: #8a7d6a;
      text-align:center;
    }

    .callout{
      margin: 14px auto 0;
      max-width: 920px;
      text-align:center;
      color:#8a7d6a;
      font-size: 0.86rem;
      line-height: 1.5;
    }

    footer{
      margin-top: 40px;
      text-align:center;
      color: #8a7d6a;
      font-size: 0.82rem;
      line-height: 1.5;
    }

    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      .meta{ align-items:flex-start; min-width: auto; }
      .pillrow{ justify-content:flex-start; }
    }
    @media (max-width: 520px){
      .countdown{ grid-template-columns: repeat(2, 1fr); }
      .num{ font-size: 2.05rem; }
      .title{ font-size: 2.05rem; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- COUNTDOWN -->
    <header>
      <div class="hero">
        <div class="title">MYOKO</div>
        <div class="subtitle">Countdown to 8 February 2026</div>

        <div class="countdown" aria-label="Countdown timer">
          <div class="time-box">
            <div class="num" id="days">0</div>
            <div class="lbl">Days</div>
          </div>
          <div class="time-box">
            <div class="num" id="hours">00</div>
            <div class="lbl">Hours</div>
          </div>
          <div class="time-box">
            <div class="num" id="minutes">00</div>
            <div class="lbl">Minutes</div>
          </div>
          <div class="time-box">
            <div class="num" id="seconds">00</div>
            <div class="lbl">Seconds</div>
          </div>
        </div>

        <div class="statusline" id="countdownStatus"></div>
      </div>
    </header>

    <!-- DINING OPTIONS -->
    <section class="section" id="dining">
      <h2>Dining Options for Dinner</h2>
      <p class="hint">
        Vote for your preferred dinner spot. Results are pulled from a shared Google Sheet.
        Each device can vote once per restaurant, saved in your browser.
      </p>

      <div class="grid" id="restaurantGrid"></div>

      <div class="smallnote">
        Voting works when your Apps Script Web App is deployed with access set to Anyone.
      </div>

      <div class="statusline" id="voteStatus"></div>

      <div class="callout">
        Distance notes are estimates from Sugi Chalet (Suginohara) to each restaurant area.
        Akakura options are typically a short drive, while Madarao area is farther.
      </div>
    </section>

    <!-- ACCOMMODATION -->
    <section class="section" id="accommodation">
      <h2>Accommodation</h2>
      <p class="hint">
        Base: Sugi Chalet, near Suginohara Ski Resort. Sleeps large groups and is positioned for quick access to the slopes.
      </p>

      <div class="grid">
        <div class="card">
          <div class="toprow">
            <div>
              <h3 class="name">Sugi Chalet</h3>
              <div class="cuisine">Suginohara, Myoko</div>
            </div>
            <div class="meta">
              <div class="pillrow">
                <div class="pill" title="Large group friendly">
                  <span class="icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                  <span>Group friendly</span>
                </div>
                <div class="pill" title="Ski access">
                  <span class="icon">‚õ∑Ô∏è</span>
                  <span>Ski-in / Ski-out area</span>
                </div>
              </div>
            </div>
          </div>

          <div class="badge" title="Quick summary">
            <span class="icon">üè∑Ô∏è</span>
            <span>Good base for a 12 pax trip, easier logistics for breakfasts, gear, and regrouping.</span>
          </div>

          <div class="desc">
            <ul style="margin:10px 0 0; padding-left: 18px;">
              <li>Address listed as 253-2 Suginosawa, Myoko, Niigata 949-2113.</li>
              <li>Designed for larger groups, long shared-table meals, and relaxing after skiing.</li>
              <li>Close to Suginohara lifts and slopes, and a convenient drive to dinner areas.</li>
            </ul>
          </div>

          <div class="links" aria-label="Accommodation links">
            <a class="linkbtn" href="https://maps.app.goo.gl/WQTSGNowg6dwxg539" target="_blank" rel="noopener noreferrer">
              <span class="icon">üìç</span><span>Google Maps</span>
            </a>
            <a class="linkbtn" href="https://escapemyoko.com/sugi-chalet/" target="_blank" rel="noopener noreferrer">
              <span class="icon">üèîÔ∏è</span><span>Official page</span>
            </a>
            <a class="linkbtn" href="https://escapemyoko.com/contact-escape-myoko/" target="_blank" rel="noopener noreferrer">
              <span class="icon">‚òéÔ∏è</span><span>Contact details</span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <footer>
      Tip: For a group of 12, confirm seating layout when booking.
      If a venue is very small, split into two tables or two time slots.
    </footer>
  </div>

  <script>
    /***********************
     * COUNTDOWN
     ***********************/
    const targetDate = new Date("2026-02-08T00:00:00").getTime();
    function pad2(n){ return String(n).padStart(2, "0"); }

    function updateCountdown() {
      const now = Date.now();
      const diff = targetDate - now;

      if (diff <= 0) {
        document.getElementById("days").textContent = "0";
        document.getElementById("hours").textContent = "00";
        document.getElementById("minutes").textContent = "00";
        document.getElementById("seconds").textContent = "00";
        document.getElementById("countdownStatus").textContent = "It is time.";
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      document.getElementById("days").textContent = days;
      document.getElementById("hours").textContent = pad2(hours);
      document.getElementById("minutes").textContent = pad2(minutes);
      document.getElementById("seconds").textContent = pad2(seconds);
      document.getElementById("countdownStatus").textContent = "";
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);

    /***********************
     * LINKS HELPERS
     ***********************/
    function mapsSearchLink(query){
      return "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(query);
    }
    function mapsPhotosLink(query){
      return mapsSearchLink(query + " photos");
    }

    /***********************
     * DISTANCE ESTIMATES (rough, by road)
     * Base: Sugi Chalet (Suginohara / Suginosawa)
     ***********************/
    const distanceNotes = {
      AKAKURA: "Approx 8 to 12 km, about 12 to 20 min by car (snow and traffic can change this).",
      SEKIGAWA: "Approx 6 to 10 km, about 10 to 18 min by car.",
      TARUMOTO_MADARAO: "Approx 22 to 30 km, about 30 to 45 min by car."
    };

    /***********************
     * DINING DATA
     * Google Reviews buttons removed
     ***********************/
    const restaurants = [
      {
        name: "Pontaro",
        cuisine: "Izakaya",
        groupFit: "Good",
        reservation: "Medium",
        distance: distanceNotes.AKAKURA,
        why12: "Small plates make it easy to share, and ordering is flexible for mixed appetites.",
        details: [
          "Izakaya style, lots of small dishes so the table can try many items.",
          "Good for a relaxed, chatty dinner and drinks.",
          "Cash only is commonly noted, plan your wallet before you go."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Pontaro izakaya Myoko Akakura") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Pontaro izakaya Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com.sg/Restaurant_Review-g1021352-d9693451-Reviews-Izakaya_Pontaro-Myoko_Niigata_Prefecture_Koshinetsu_Chubu.html" },
          { label: "Myoko Tourism", icon: "‚ÑπÔ∏è", url: "https://myokotourism.com/restaurants/pontaro/" }
        ]
      },
      {
        name: "Yakitori Asagao",
        cuisine: "Yakitori",
        groupFit: "Limited",
        reservation: "Medium-Hard",
        distance: distanceNotes.AKAKURA,
        why12: "Best if you are happy to split into two groups or stagger timing.",
        details: [
          "Charcoal grilled skewers, usually served in rounds, great for trying variety.",
          "Often compact seating, so a full 12 in one table may be tough.",
          "Good choice if your group likes focused food and does not mind splitting."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Yakitori Asagao Myoko Akakura") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Yakitori Asagao Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com/Restaurant_Review-g1021352-d12233128-Reviews-Yakitori_Asagao-Myoko_Niigata_Prefecture_Koshinetsu_Chubu.html" },
          { label: "Wanderlog", icon: "üß≠", url: "https://wanderlog.com/place/details/2675820/%E5%82%99%E9%95%B7%E7%82%AD%E7%81%AB%E3%82%84%E3%81%8D%E3%81%A8%E3%82%8A-%E9%BA%BB%E9%A1%94-yakitori-asagao" }
        ]
      },
      {
        name: "Udon no Fu",
        cuisine: "Udon",
        groupFit: "Limited",
        reservation: "Hard",
        distance: distanceNotes.AKAKURA,
        why12: "Comfort meal, but easier if you split the group or go early.",
        details: [
          "Warm noodle option that is great after a cold day out.",
          "Often smaller dining rooms, so one large table is unlikely.",
          "Good fallback if you want something simple and fast."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Udon no Fu Myoko Akakura") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Udon no Fu Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com.sg/Restaurant_Review-g1021352-d7557583-Reviews-Udon_No_Fu-Myoko_Niigata_Prefecture_Koshinetsu_Chubu.html" },
          { label: "Tabelog", icon: "üìí", url: "https://tabelog.com/en/niigata/A1503/A150303/15014439/" }
        ]
      },
      {
        name: "Noren Akakura Sushi",
        cuisine: "Sushi",
        groupFit: "Limited",
        reservation: "Hard",
        distance: distanceNotes.AKAKURA,
        why12: "Works best as a smaller sub group option for a sushi focused night.",
        details: [
          "Sushi focused dinner, often a more intimate pace and setting.",
          "Capacity can be tight, splitting the group is the realistic plan.",
          "Aim to book early, especially on peak ski weeks."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Noren Akakura Sushi Myoko") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Noren Akakura Sushi Myoko") },
          { label: "Wanderlog", icon: "üß≠", url: "https://wanderlog.com/tr/place/details/13203682/%E3%81%AE%E3%82%8C%E3%82%93-noren-akakura-sushimyoko" }
        ]
      },
      {
        name: "Takasago Sushi",
        cuisine: "Sushi",
        groupFit: "Limited",
        reservation: "Hard",
        distance: distanceNotes.SEKIGAWA,
        why12: "Better for a smaller group who wants classic sushi in a quieter setting.",
        details: [
          "Traditional, family run feel is often mentioned by visitors.",
          "Smaller room, so plan on splitting if your full group wants sushi.",
          "Good pick if you want a calm dinner away from the main ski street."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Takasago Sushi Myoko") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Takasago Sushi Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com.sg/Restaurant_Review-g1021352-d7557657-Reviews-Takasago_Sushi-Myoko_Niigata_Prefecture_Koshinetsu_Chubu.html" },
          { label: "Tabelog", icon: "üìí", url: "https://s.tabelog.com/en/niigata/A1503/A150303/15004285/" }
        ]
      },
      {
        name: "Shokudo en",
        cuisine: "Yakiniku",
        groupFit: "Good",
        reservation: "Medium",
        distance: distanceNotes.AKAKURA,
        why12: "BBQ format keeps it social, and sharing set orders is straightforward.",
        details: [
          "Tabletop grill yakiniku, interactive and great for groups.",
          "Often described as small and popular, booking ahead is smart.",
          "Expect a smoky vibe, wear gear you can wash easily."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Shokudoen yakiniku Myoko Akakura") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Shokudoen Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com.sg/Restaurant_Review-g1021352-d7557656-Reviews-Shokudo_En-Myoko_Niigata_Prefecture_Koshinetsu_Chubu.html" },
          { label: "Myoko Tourism", icon: "‚ÑπÔ∏è", url: "https://myokotourism.com/restaurants/shokudoen/" },
          { label: "Tabelog", icon: "üìí", url: "https://s.tabelog.com/en/niigata/A1503/A150303/15005529/" }
        ]
      },
      {
        name: "Restaurant Shibata",
        cuisine: "Japanese",
        groupFit: "Excellent",
        reservation: "Easy-Medium",
        distance: distanceNotes.AKAKURA,
        why12: "Broad menu and group friendly setup makes planning simpler for 12.",
        details: [
          "Large menu, often suitable for mixed preferences including vegetarians.",
          "A reliable choice on peak nights because it is more geared for groups.",
          "If you want faster service, pre-pick a few shared staples for the table."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Restaurant Shibata Myoko Akakura") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Restaurant Shibata Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com/Restaurant_Review-g1021352-d5773296-Reviews-Restaurant_Shibata-Myoko_Niigata_Prefecture_Koshinetsu_Chubu.html" },
          { label: "Myoko Tourism", icon: "‚ÑπÔ∏è", url: "https://myokotourism.com/restaurants/restaurant-shibata/" },
          { label: "Reservation notes", icon: "üìå", url: "https://www.myoko-shibata.com/access-%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9/how-to-make-a-resevation/" }
        ]
      },
      {
        name: "Restaurant Rudolf",
        cuisine: "Italian",
        groupFit: "Excellent",
        reservation: "Easy",
        distance: distanceNotes.TARUMOTO_MADARAO,
        why12: "Pizza and pasta sharing works well, and large groups are easier to seat.",
        details: [
          "Comfort option when the group wants something familiar and hearty.",
          "Good for sharing, order several pizzas plus a few pasta dishes and salads.",
          "Located in Tarumoto area, plan transport and timing."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Restaurant Rudolf Myoko Tarumoto") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Restaurant Rudolf Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com.sg/Restaurant_Review-g1021352-d4902024-Reviews-Restaurant_Rudolf-Myoko_Niigata_Prefecture_Koshinetsu_Chubu.html" },
          { label: "Wanderlog", icon: "üß≠", url: "https://wanderlog.com/place/details/2675791/rudolf" }
        ]
      },
      {
        name: "Full Circle Snowsurf",
        cuisine: "Cafe / Bar",
        groupFit: "Good",
        reservation: "Easy",
        distance: distanceNotes.AKAKURA,
        why12: "Casual format with flexible seating, good when the group arrives in waves.",
        details: [
          "Good coffee, casual food, and a laid-back hangout vibe.",
          "Great for early dinner into drinks, or a relaxed night with music.",
          "If you want a quieter meal, go earlier, if you want lively, go later."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Full Circle Snowsurf Cafe Restaurant Bar Myoko Akakura") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Full Circle Snowsurf Myoko") },
          { label: "TripAdvisor", icon: "üó£Ô∏è", url: "https://www.tripadvisor.com/Restaurant_Review-g1021352-d13371720-Reviews-Full_Circle_Snowsurf_Cafe_Restaurant_Bar-Myoko_Niigata_Prefecture_Koshinetsu_Ch.html" },
          { label: "Instagram", icon: "üì∑", url: "https://www.instagram.com/flcircle/?hl=en" }
        ]
      },
      {
        name: "Obake Bar & Restaurant",
        cuisine: "Bar / Japanese-Mex fusion",
        groupFit: "Good",
        reservation: "Medium",
        distance: distanceNotes.AKAKURA,
        why12: "Great for a social night, easier if you book and arrive on time.",
        details: [
          "Bar focused dinner with food plus cocktails, great for celebrating.",
          "Often highlighted for veg options as well, helpful for mixed diets.",
          "If you want a long hangout after dinner, this is a strong choice."
        ],
        links: [
          { label: "Google Maps", icon: "üìç", url: mapsSearchLink("Obake Bar Myoko Akakura") },
          { label: "Photos", icon: "üñºÔ∏è", url: mapsPhotosLink("Obake Bar Myoko") },
          { label: "Instagram", icon: "üì∑", url: "https://www.instagram.com/obakebarmyoko/" },
          { label: "HappyCow", icon: "ü•ó", url: "https://www.happycow.net/reviews/obake-bar-myoko-445566" }
        ]
      }
    ];

    /***********************
     * ICONS
     ***********************/
    function groupTone(fit){
      const f = fit.toLowerCase();
      if (f.includes("excellent")) return "‚úÖ";
      if (f.includes("good")) return "üëç";
      if (f.includes("limited")) return "‚ö†Ô∏è";
      return "üö´";
    }
    function groupLabel(fit){
      const f = fit.toLowerCase();
      if (f.includes("excellent")) return "Group fit: Excellent";
      if (f.includes("good")) return "Group fit: Good";
      if (f.includes("limited")) return "Group fit: Limited";
      return "Group fit: Split needed";
    }
    function resIcon(level){
      const l = level.toLowerCase();
      if (l.includes("easy")) return "üü¢";
      if (l.includes("medium")) return "üü°";
      return "üî¥";
    }
    function resLabel(level){
      const l = level.toLowerCase();
      if (l.includes("easy")) return "Reservation: Easy";
      if (l.includes("medium")) return "Reservation: Medium";
      if (l.includes("hard")) return "Reservation: Hard";
      return "Reservation: Medium";
    }

    /***********************
     * GOOGLE SHEETS VOTING
     ***********************/
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxpMj-GRBmhoXdLnodt6bEJ9egh8RCvyqlnBfVC7Bk089s3m5VkepK1O-KlVMfZGimgTg/exec";
    const VOTE_KEY = "myoko_votes_v3";
    const voteStatus = document.getElementById("voteStatus");

    function setStatus(msg){ voteStatus.textContent = msg || ""; }

    function getVoteStore(){
      try { return JSON.parse(localStorage.getItem(VOTE_KEY) || "{}"); }
      catch { return {}; }
    }
    function setVoted(name){
      const store = getVoteStore();
      store[name] = true;
      localStorage.setItem(VOTE_KEY, JSON.stringify(store));
    }
    function hasVoted(name){
      return !!getVoteStore()[name];
    }

    /***********************
     * RENDER
     ***********************/
    const grid = document.getElementById("restaurantGrid");

    function safeId(name){
      return "r_" + name.replace(/[^a-zA-Z0-9]+/g, "_");
    }

    function renderRestaurants(){
      grid.innerHTML = "";

      restaurants.forEach(r => {
        const id = safeId(r.name);
        const voted = hasVoted(r.name);

        const detailsHtml = r.details.map(line => `<li>${line}</li>`).join("");
        const linksHtml = r.links.map(l =>
          `<a class="linkbtn" href="${l.url}" target="_blank" rel="noopener noreferrer">
             <span class="icon">${l.icon}</span><span>${l.label}</span>
           </a>`
        ).join("");

        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute("data-name", r.name);

        card.innerHTML = `
          <div class="toprow">
            <div>
              <h3 class="name">${r.name}</h3>
              <div class="cuisine">${r.cuisine}</div>
            </div>
            <div class="meta">
              <div class="pillrow">
                <div class="pill" title="${groupLabel(r.groupFit)}">
                  <span class="icon">${groupTone(r.groupFit)}</span>
                  <span>${groupLabel(r.groupFit)}</span>
                </div>
                <div class="pill" title="${resLabel(r.reservation)}">
                  <span class="icon">${resIcon(r.reservation)}</span>
                  <span>${resLabel(r.reservation)}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="badge" title="Why this works for 12">
            <span class="icon">üè∑Ô∏è</span>
            <span>${r.why12}</span>
          </div>

          <div class="desc" style="margin-top:10px;">
            <div style="margin: 0 0 10px; color:#6a7a71; font-size:0.90rem;">
              <span class="icon" style="margin-right:8px;">üöó</span>
              <strong>From Sugi Chalet:</strong> ${r.distance}
            </div>
            <ul style="margin:10px 0 0; padding-left: 18px;">
              ${detailsHtml}
            </ul>
          </div>

          <div class="links" aria-label="Links">
            ${linksHtml}
          </div>

          <div class="actions">
            <button class="vote" id="${id}_btn" ${voted ? "disabled" : ""}>
              ${voted ? "Voted" : "Vote"}
            </button>
            <div class="votes" id="${id}_votes">0 votes</div>
          </div>
        `;

        grid.appendChild(card);

        const btn = document.getElementById(`${id}_btn`);
        btn.addEventListener("click", () => vote(r.name));
      });
    }

    renderRestaurants();

    /***********************
     * VOTE POST
     ***********************/
    async function vote(name){
      if (hasVoted(name)) {
        setStatus("You already voted for this option on this device.");
        return;
      }

      setStatus("Submitting vote...");

      try {
        const body = new URLSearchParams({ restaurant: name });

        await fetch(SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          body
        });

        setVoted(name);
        renderRestaurants();
        setStatus("Vote submitted.");
        setTimeout(fetchVotesJSONP, 900);

      } catch (e) {
        setStatus("Vote failed. Recheck Apps Script deployment access.");
      }
    }

    /***********************
     * FETCH VOTES VIA JSONP
     ***********************/
    function fetchVotesJSONP(){
      const cbName = "votes_cb_" + Math.random().toString(16).slice(2);

      window[cbName] = function(data){
        try {
          restaurants.forEach(r => {
            const id = safeId(r.name);
            const count = (data && data[r.name]) ? data[r.name] : 0;
            const el = document.getElementById(`${id}_votes`);
            if (el) el.textContent = `${count} votes`;
          });

          const cards = Array.from(grid.querySelectorAll(".card"));
          cards.sort((a, b) => {
            const an = a.getAttribute("data-name");
            const bn = b.getAttribute("data-name");
            const av = (data && data[an]) ? data[an] : 0;
            const bv = (data && data[bn]) ? data[bn] : 0;
            return bv - av;
          });
          cards.forEach(c => grid.appendChild(c));
        } finally {
          cleanup();
        }

        function cleanup(){
          delete window[cbName];
          const s = document.getElementById(cbName);
          if (s) s.remove();
        }
      };

      const script = document.createElement("script");
      script.id = cbName;
      script.src = `${SCRIPT_URL}?callback=${cbName}&_=${Date.now()}`;
      document.body.appendChild(script);
    }

    fetchVotesJSONP();
    setInterval(fetchVotesJSONP, 8000);
  </script>
</body>
</html>
